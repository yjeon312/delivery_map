<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Kakao Multi-Route Finder</title>
    <style>
        :root { --k-yellow: #fee500; --k-brown: #3c1e1e; }
        body { font-family: 'Malgun Gothic', sans-serif; background: #f9f9f9; padding: 20px; }
        .app-container { max-width: 900px; margin: 0 auto; display: flex; flex-direction: column; gap: 15px; }
        .input-card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .route-row { display: flex; align-items: center; margin-bottom: 8px; gap: 10px; }
        .label { width: 40px; font-weight: bold; color: #555; }
        input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; outline: none; }
        input:focus { border-color: var(--k-yellow); }
        button { border: none; cursor: pointer; border-radius: 8px; font-weight: bold; transition: 0.2s; }
        .btn-add { background: #eee; padding: 8px 15px; }
        .btn-search { background: var(--k-yellow); color: var(--k-brown); padding: 15px; width: 100%; font-size: 16px; margin-top: 10px; }
        .btn-search:hover { background: #fada00; }
        #map { width: 100%; height: 500px; border-radius: 15px; border: 1px solid #ddd; }
        .info-box { padding: 15px; background: #eef2ff; border-radius: 10px; border-left: 5px solid #4f46e5; display: none; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="input-card">
        <div class="route-row">
            <span class="label">ì¶œë°œ</span>
            <input type="text" id="startAddr" value="ì„œìš¸ì—­" placeholder="ì¶œë°œì§€ ì£¼ì†Œ">
        </div>
        <div id="waypoint-list">
            <div class="route-row">
                <span class="label">ê²½ìœ </span>
                <input type="text" class="wp-addr" placeholder="ê²½ìœ ì§€ ì£¼ì†Œ">
            </div>
        </div>
        <button class="btn-add" onclick="addWaypoint()">+ ê²½ìœ ì§€ ì¶”ê°€</button>
        <div class="route-row" style="margin-top:10px;">
            <span class="label">ë„ì°©</span>
            <input type="text" id="endAddr" value="ë¶€ì‚°ì—­" placeholder="ë„ì°©ì§€ ì£¼ì†Œ">
        </div>
        <button class="btn-search" onclick="findRoute()">ê²½ë¡œ íƒìƒ‰ ë° ê¸¸ì°¾ê¸° ì‹¤í–‰</button>
    </div>

    <div id="info-box" class="info-box"></div>
    <div id="map"></div>
</div>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=cc6395efcb6491cc27cc6346dc2f5283&libraries=services,navidapi"></script>

<script>
    const mapContainer = document.getElementById('map');
    const mapOption = { center: new kakao.maps.LatLng(37.5668, 126.9786), level: 4 };
    const map = new kakao.maps.Map(mapContainer, mapOption);
    const geocoder = new kakao.maps.services.Geocoder();
    let markers = [];

    function addWaypoint() {
        const container = document.getElementById('waypoint-list');
        const div = document.createElement('div');
        div.className = 'route-row';
        div.innerHTML = `<span class="label">ê²½ìœ </span><input type="text" class="wp-addr" placeholder="ê²½ìœ ì§€ ì£¼ì†Œ">`;
        container.appendChild(div);
    }

    async function findRoute() {
        const startAddr = document.getElementById('startAddr').value;
        const endAddr = document.getElementById('endAddr').value;
        const wpInputs = document.getElementsByClassName('wp-addr');

        try {
            // 1. ëª¨ë“  ì§€ì ì˜ ì¢Œí‘œ ì°¾ê¸°
            const start = await searchAddress(startAddr);
            const end = await searchAddress(endAddr);
            let waypoints = [];
            for(let input of wpInputs) {
                if(input.value.trim()) waypoints.push(await searchAddress(input.value));
            }

            // 2. ì§€ë„ ë§ˆì»¤ ì´ˆê¸°í™” ë° í‘œì‹œ
            clearMarkers();
            drawMarker(start, "ì¶œë°œ");
            drawMarker(end, "ë„ì°©");
            waypoints.forEach((wp, idx) => drawMarker(wp, `ê²½ìœ ${idx+1}`));

            // 3. ì§€ë„ ë²”ìœ„ ì¡°ì •
            const bounds = new kakao.maps.LatLngBounds();
            bounds.extend(start);
            bounds.extend(end);
            waypoints.forEach(wp => bounds.extend(wp));
            map.setBounds(bounds);

            // 4. ê²°ê³¼ ì•Œë¦¼ ë° ì™¸ë¶€ ê¸¸ì°¾ê¸° ì—°ë™
            const info = document.getElementById('info-box');
            info.style.display = 'block';
            info.innerHTML = `
                <strong>ğŸ“ ì¢Œí‘œ ê²€ìƒ‰ ì™„ë£Œ</strong><br>
                ì§€ë„ì— ì§€ì ë“¤ì´ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤. ìƒì„¸ ê²½ë¡œ ë° ì‹¤ì‹œê°„ ì†Œìš” ì‹œê°„ì€ ì¹´ì¹´ì˜¤ë§µ ì•± ë˜ëŠ” ì›¹ìœ¼ë¡œ ì—°ê²°ë©ë‹ˆë‹¤.<br><br>
                <button onclick="openKakaoMap('${startAddr}', '${endAddr}')" style="background:#4a90e2; color:white; padding:5px 10px;">ì¹´ì¹´ì˜¤ë§µì—ì„œ ê²½ë¡œ í™•ì¸</button>
            `;

        } catch (e) {
            alert("ì£¼ì†Œë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”: " + e);
        }
    }

    function searchAddress(addr) {
        return new Promise((resolve, reject) => {
            geocoder.addressSearch(addr, (result, status) => {
                if (status === kakao.maps.services.Status.OK) {
                    resolve(new kakao.maps.LatLng(result[0].y, result[0].x));
                } else reject(addr);
            });
        });
    }

    function drawMarker(pos, title) {
        const marker = new kakao.maps.Marker({ position: pos, map: map });
        const infowindow = new kakao.maps.InfoWindow({ content: `<div style="padding:5px;font-size:12px;">${title}</div>` });
        infowindow.open(map, marker);
        markers.push(marker);
    }

    function clearMarkers() {
        markers.forEach(m => m.setMap(null));
        markers = [];
    }

    function openKakaoMap(sName, eName) {
        // ì¹´ì¹´ì˜¤ë§µ ê¸¸ì°¾ê¸° URL (ì›¹/ì•± ì—°ë™)
        const url = `https://map.kakao.com/?sName=${encodeURIComponent(sName)}&eName=${encodeURIComponent(eName)}`;
        window.open(url, '_blank');
    }
</script>
</body>
</html>
