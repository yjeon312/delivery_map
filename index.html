<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <title>ì¹´ì¹´ì˜¤ ì§€ë„ ìµœì  ê²½ë¡œ</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; background: #f0f2f5; }
        .container { max-width: 700px; margin: 0 auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .input-group { margin-bottom: 10px; display: flex; align-items: center; }
        .input-group label { width: 60px; font-weight: bold; }
        input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-search { background: #fee500; width: 100%; margin-top: 10px; font-size: 16px; }
        .btn-add { background: #e9ecef; margin: 5px 0 15px 60px; font-size: 12px; }
        #map { width: 100%; height: 450px; margin-top: 20px; border-radius: 10px; border: 1px solid #ddd; }
        #result-info { margin-top: 15px; padding: 10px; background: #fffde7; border-left: 4px solid #fbc02d; display: none; }
    </style>
</head>
<body>

<div class="container">
    <h3>ğŸš— ìµœì  ê²½ë¡œ íƒìƒ‰ (SDK ë²„ì „)</h3>
    
    <div class="input-group">
        <label>ì¶œë°œ</label>
        <input type="text" id="startAddr" value="ì„œìš¸ì—­" placeholder="ì¶œë°œì§€ ì£¼ì†Œ">
    </div>

    <div id="waypoint-area">
        <div class="input-group">
            <label>ê²½ìœ </label>
            <input type="text" class="wp-addr" placeholder="ê²½ìœ ì§€ ì£¼ì†Œ (ì„ íƒ)">
        </div>
    </div>
    <button class="btn-add" onclick="addWaypoint()">+ ê²½ìœ ì§€ ì¶”ê°€</button>

    <div class="input-group">
        <label>ë„ì°©</label>
        <input type="text" id="endAddr" value="ë¶€ì‚°ì—­" placeholder="ë„ì°©ì§€ ì£¼ì†Œ">
    </div>

    <button class="btn-search" onclick="startNavigation()">ê²½ë¡œ í™•ì¸í•˜ê¸°</button>

    <div id="result-info"></div>
    <div id="map"></div>
</div>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=cc6395efcb6491cc27cc6346dc2f5283&libraries=services"></script>

<script>
    var mapContainer = document.getElementById('map'),
        mapOption = { center: new kakao.maps.LatLng(37.5668, 126.9786), level: 3 };
    var map = new kakao.maps.Map(mapContainer, mapOption);
    var geocoder = new kakao.maps.services.Geocoder();
    var markers = [];

    function addWaypoint() {
        const div = document.createElement('div');
        div.className = 'input-group';
        div.innerHTML = '<label>ê²½ìœ </label><input type="text" class="wp-addr" placeholder="ê²½ìœ ì§€ ì£¼ì†Œ">';
        document.getElementById('waypoint-area').appendChild(div);
    }

    async function startNavigation() {
        const sAddr = document.getElementById('startAddr').value;
        const eAddr = document.getElementById('endAddr').value;
        const wpNodes = document.querySelectorAll('.wp-addr');

        try {
            // 1. ì£¼ì†Œ -> ì¢Œí‘œ ë³€í™˜ (SDK ì„œë¹„ìŠ¤ ì´ìš©)
            const sPos = await addrToCoords(sAddr);
            const ePos = await addrToCoords(eAddr);
            
            clearMarkers();
            addMarker(sPos, "ì¶œë°œ");
            addMarker(ePos, "ë„ì°©");

            let wpCoords = [];
            for (let node of wpNodes) {
                if (node.value.trim()) {
                    const pos = await addrToCoords(node.value);
                    wpCoords.push(pos);
                    addMarker(pos, "ê²½ìœ ");
                }
            }

            // 2. ì§€ë„ ë²”ìœ„ ì¡°ì •
            const bounds = new kakao.maps.LatLngBounds();
            bounds.extend(sPos);
            bounds.extend(ePos);
            wpCoords.forEach(p => bounds.extend(p));
            map.setBounds(bounds);

            // 3. ê²°ê³¼ ì•ˆë‚´ (SDK ë°©ì‹ì€ ë³´ì•ˆìƒ ê¸¸ì°¾ê¸° í™”ë©´ìœ¼ë¡œ ì—°ê²°í•˜ëŠ” ê²ƒì´ ìµœì„ )
            const resDiv = document.getElementById('result-info');
            resDiv.style.display = 'block';
            resDiv.innerHTML = `
                <strong>ğŸ“ ì§€ì  ë“±ë¡ ì™„ë£Œ</strong><br>
                ì…ë ¥í•˜ì‹  ì£¼ì†Œë“¤ì´ ì§€ë„ì— í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.<br>
                <a href="https://map.kakao.com/?sName=${encodeURIComponent(sAddr)}&eName=${encodeURIComponent(eAddr)}" target="_blank" style="color:blue; text-decoration:underline;">
                ğŸ‘‰ ì—¬ê¸°ë¥¼ í´ë¦­í•˜ì—¬ ì‹¤ì‹œê°„ ìµœì  ê²½ë¡œì™€ ì†Œìš” ì‹œê°„ í™•ì¸í•˜ê¸°
                </a>
            `;

        } catch (err) {
            alert("ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: " + err);
        }
    }

    function addrToCoords(addr) {
        return new Promise((resolve, reject) => {
            geocoder.addressSearch(addr, function(result, status) {
                if (status === kakao.maps.services.Status.OK) {
                    resolve(new kakao.maps.LatLng(result[0].y, result[0].x));
                } else {
                    reject(addr);
                }
            });
        });
    }

    function addMarker(pos, title) {
        var marker = new kakao.maps.Marker({ position: pos, map: map });
        markers.push(marker);
        var iw = new kakao.maps.InfoWindow({ content: `<div style="padding:5px;font-size:12px;">${title}</div>` });
        iw.open(map, marker);
    }

    function clearMarkers() {
        markers.forEach(m => m.setMap(null));
        markers = [];
    }
</script>
</body>
</html>
