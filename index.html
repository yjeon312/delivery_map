<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <title>ì¹´ì¹´ì˜¤ ì§€ë„ ê²½ë¡œ íƒìƒ‰</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; background: #f4f4f4; }
        .box { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .row { margin-bottom: 10px; display: flex; align-items: center; }
        label { width: 50px; font-weight: bold; }
        input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        button { width: 100%; padding: 12px; background: #fee500; border: none; cursor: pointer; font-weight: bold; margin-top: 10px; }
        #map { width: 100%; height: 400px; margin-top: 20px; border-radius: 10px; border: 1px solid #ddd; }
        .info { margin-top: 15px; font-size: 14px; color: #333; line-height: 1.6; display: none; }
    </style>
</head>
<body>

<div class="box">
    <h3>ğŸš— ìµœì  ê²½ë¡œ íƒìƒ‰ê¸°</h3>
    <div class="row"><label>ì¶œë°œ</label><input type="text" id="startAddr" value="ì„œìš¸ ì„œì´ˆêµ¬ ì ì›ë¡œ 166-17"></div>
    <div id="wp-container">
        <div class="row"><label>ê²½ìœ </label><input type="text" class="wp-addr" value="ëŒ€êµ¬ ìˆ˜ì„±êµ¬ ì‹ ì²œë™ë¡œ 320"></div>
    </div>
    <div class="row"><label>ë„ì°©</label><input type="text" id="endAddr" value="ì„œìš¸ ì„œì´ˆêµ¬ ì ì›ë¡œ 166-17"></div>
    
    <button onclick="startSearch()">ê²½ë¡œ íƒìƒ‰ ë° ê¸¸ì°¾ê¸° ì‹¤í–‰</button>
    
    <div id="info" class="info"></div>
    <div id="map"></div>
</div>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=cc6395efcb6491cc27cc6346dc2f5283&libraries=services"></script>

<script>
    // ë³€ìˆ˜ ì´ˆê¸°í™” ì˜¤ë¥˜ ë°©ì§€ë¥¼ ìœ„í•´ ì „ì—­ ì„ ì–¸ì„ í”¼í•˜ê³  í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì´ˆê¸°í™”
    var map, geocoder, markers = [];

    // í˜ì´ì§€ ë¡œë“œ í›„ ì§€ë„ ì´ˆê¸°í™”
    window.onload = function() {
        var container = document.getElementById('map');
        var options = { center: new kakao.maps.LatLng(37.5668, 126.9786), level: 3 };
        map = new kakao.maps.Map(container, options);
        geocoder = new kakao.maps.services.Geocoder();
    };

    function startSearch() {
        var sAddr = document.getElementById('startAddr').value;
        var eAddr = document.getElementById('endAddr').value;
        var wpInputs = document.querySelectorAll('.wp-addr');

        // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
        for (var i = 0; i < markers.length; i++) { markers[i].setMap(null); }
        markers = [];

        var bounds = new kakao.maps.LatLngBounds();

        // 1. ì¶œë°œì§€ ê²€ìƒ‰
        geocoder.addressSearch(sAddr, function(result, status) {
            if (status === kakao.maps.services.Status.OK) {
                var pos = new kakao.maps.LatLng(result[0].y, result[0].x);
                addMarker(pos, "ì¶œë°œ");
                bounds.extend(pos);

                // 2. ë„ì°©ì§€ ê²€ìƒ‰ (ìˆœì°¨ ì‹¤í–‰)
                geocoder.addressSearch(eAddr, function(result, status) {
                    if (status === kakao.maps.services.Status.OK) {
                        var pos = new kakao.maps.LatLng(result[0].y, result[0].x);
                        addMarker(pos, "ë„ì°©");
                        bounds.extend(pos);

                        // 3. ê²½ìœ ì§€ ê²€ìƒ‰ ë° ìµœì¢… ì²˜ë¦¬
                        var wpCount = 0;
                        if(wpInputs.length === 0) finish();
                        
                        for(var j=0; j<wpInputs.length; j++) {
                            (function(index) {
                                geocoder.addressSearch(wpInputs[index].value, function(res, stat) {
                                    if(stat === kakao.maps.services.Status.OK) {
                                        var p = new kakao.maps.LatLng(res[0].y, res[0].x);
                                        addMarker(p, "ê²½ìœ ");
                                        bounds.extend(p);
                                    }
                                    wpCount++;
                                    if(wpCount === wpInputs.length) finish();
                                });
                            })(j);
                        }
                    }
                });
            } else {
                alert("ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            }
        });

        function finish() {
            map.setBounds(bounds);
            var info = document.getElementById('info');
            info.style.display = 'block';
            info.innerHTML = "<strong>âœ… íƒìƒ‰ ì™„ë£Œ</strong><br>ì¢Œí‘œ ê¸°ë°˜ ê¸¸ì°¾ê¸°ëŠ” ì•„ë˜ ë§í¬ë¥¼ ì´ìš©í•˜ì„¸ìš”.<br>" + 
                             "<a href='https://map.kakao.com/?sName="+encodeURIComponent(sAddr)+"&eName="+encodeURIComponent(eAddr)+"' target='_blank'>[ì¹´ì¹´ì˜¤ë§µ ê¸¸ì°¾ê¸° ë°”ë¡œê°€ê¸°]</a>";
        }
    }

    function addMarker(pos, title) {
        var marker = new kakao.maps.Marker({ position: pos, map: map });
        markers.push(marker);
        var iw = new kakao.maps.InfoWindow({ content: '<div style="padding:5px;font-size:12px;">'+title+'</div>' });
        iw.open(map, marker);
    }
</script>
</body>
</html>
